{include file="/common/head" /}
<link rel="stylesheet" href="/static/css/DPlayer.min.css">
<style>
    #dplayer {
        width: 100%;
        height: 100%;
        margin: 0 auto;
    }
    .dplayer-logo{
        left: 10px;
        top: 10px;
        max-width: 100px;
        max-height: 50px;
    }
</style>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

    <!-- Navbar -->
    {include file="/common/navbar" /}
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    {include file="/common/sidebar" /}

    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                    </div><!-- /.col -->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="/">主页</a></li>
                            <li class="breadcrumb-item"><a href="/index/videos">电视电影</a></li>
                            <li class="breadcrumb-item active">正在播放--<b id="videoName"></b></li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <!-- Main row -->
                <div class="row">
                    <!-- Left col -->
                    <section class="col-lg-6 offset-lg-3 connectedSortable">
                        <input type="text" value="{$video_detail}" hidden id="video_detail">
                        <input type="text" value="{$url}" hidden id="video_url">

                        <div class="card card-primary card-outline">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-play"></i>
                                    正在播放--<b id="videoName2"></b>
                                </h3>
                            </div>
                            <div class="card-body">
                                <div id="dplayer"></div>
                            </div>
                            <!-- /.card -->
                        </div>
                        <hr>
                    </section>
                    <!-- /.Left col -->
                    <!-- right col (We are only adding the ID to make the widgets sortable)-->
                    <section class="col-lg-6 offset-lg-3 connectedSortable">
                        <div class="card card-primary card-outline">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-edit"></i>
                                    选集
                                </h3>
                            </div>
                            <div class="card-body" id="videoIndex"></div>
                            <!-- /.card -->
                        </div>
                    </section>
                    <!-- right col -->
                </div>
                <!-- /.row (main row) -->
            </div><!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>

    {include file="/common/footer" /}
</div>
</body>
{include file="/common/scripts" /}
<script src="/static/js/hls.js"></script>
<script src="/static/js/DPlayer.min.js"></script>
<script>
    $(function () {
        var data = document.getElementById('video_detail').value ;
        var url = document.getElementById('video_url').value ;
        var parsed_data = JSON.parse(data)
        var parsed_data2 = JSON.parse(parsed_data.data)
        renderVideoName(parsed_data2)
        renderIndex(parsed_data2)
        const dp = new DPlayer({
            container: document.getElementById('dplayer'),
            logo: '/static/img/logo.png',
            video: {
                url: url,
                type: 'hls',
            },
            pluginOptions: {
                hls: {
                    // hls config
                },
            },
        });
    })

    function renderVideoName(data) {
        document.getElementById('videoName').innerHTML=data.Name;
        document.getElementById('videoName2').innerHTML=data.Name;
    }

    function renderIndex(data) {
        let form = $('#videoIndex')
        // console.log(data.MoviePlayUrls)
        var items = data.MoviePlayUrls
        for(let i = 0; i < items.length; i++){
            form.append(`
            <button type="button" class="btn btn-default btnV" onclick="goToPlay('${items[i].PlayUrl}')">${items[i].Name}</button>
            `)
        }
    }
    function goToPlay(url) {
        console.log(url)
        var data = document.getElementById('video_detail').value;
        var parsed_data = JSON.parse(data);
        var parsed_data2 = JSON.parse(parsed_data.data);
        var id = parsed_data2.ID;
        window.location.href = "/index/Videos/play?id="+id+"&url="+url;
    }


</script>
</html>